# ============================================================
# TRACEABILITY SCHEMA — mlops4ofp (versión ampliada variantes)
# ============================================================

version: "1.1"

metadata:
  description: "Esquema de trazabilidad para activos generados en el workflow MLOps4OFP con soporte para variantes."
  compatible_traceability_format: ">=1.0"

fields:

  stage:
    type: string
    required: true

  timestamp:
    type: string
    required: true

  inputs:
    type: list
    required: false

  outputs:
    type: list
    required: false

  params:
    type: dict
    required: false

  git:
    type: dict
    required: false

  variant:
    type: string
    required: false

  parent_variant:
    type: string
    required: false

# ============================================================
# REGLAS DE PARÁMETROS POR FASE
# ============================================================

param_rules:

  "01_explore":
    raw_dataset_path:
      type: string
      required: true
      
    cleaning_strategy:
      type: string
      enum: ["none", "basic", "full"]
      required: true

    nan_values:
      type: list          # validaremos que sea lista
      element_type: number   # validaremos que todos los elementos sean numéricos
      required: true

    error_values_by_column:
      type: dict          # debe ser diccionario
      required: true


  "02_prepareeventsds":
    band_thresholds_pct:
      type: list
      element_type: number
      required: true

    event_strategy:
      type: string
      enum: ["levels", "transitions", "both"]
      required: true

    nan_handling:
      type: string
      enum: ["keep", "discard"]
      required: true

    parent_variant:
      type: string
      required: true
      regex: "^v[0-9]{3}$"

    Tu:
      type: number
      required: false

  "03_preparewindowsds":

    OW:
      type: number
      required: true

    LT:
      type: number
      required: true

    PW:
      type: number
      required: true

    Tu:
      type: number
      required: false

    window_strategy:
      type: string
      enum: ["synchro", "asynOW", "withinPW", "asynPW"]
      required: true

    nan_strategy:
      type: string
      enum: ["preserve", "discard"]
      required: true

    variant_id:
      type: string
      regex: "^v[0-9]{3}$"
      required: true

    parent_variant:
      type: string
      required: true
      regex: "^v[0-9]{3}$"


  